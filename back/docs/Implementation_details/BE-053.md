# BE-053：Analysis Orchestrator 雛形（Decompose→Challenge→Verify）

## 担当者
- 萩原

## 指示
- `run(analysisId)` で `Decompose -> Challenge -> Verify` の実行フローを実装
- `updateAnalysisStatus` を段階的に呼んで progress 更新
- 解析結果 JSON を GCS に保存し、pointers/metrics を Firestore に反映

## 作業ログ
- `src/services/analysis/orchestrator.ts` で下記フローを実装
  - `EXTRACTING` で抽出実行（PDF/LaTeX）
  - `ANALYZING` で preflight/evidence/logic/prior-art/scoring を順次実行
  - 結果を `analysis/{analysisId}/result.json` に保存
  - Firestore `pointers` と `metrics` を更新
  - `READY` に遷移
- 抽出結果から claims を生成する補助ロジックを追加
- preflight/evidence/logic を統合した `topRisks` 生成を追加
- 追加で claim 抽出を「段落セグメント分割 + LLM + fallbackマージ」に拡張
- `ANALYSIS_*` 環境変数で抽出品質閾値/claim件数/segment粒度を調整可能にした
- `topRisks` を 3件固定から複数件返却に拡張し、タイトルを claimId ベースから主張テキスト要約ベースに改善
- preflight 種別ラベルを日本語化し、Summary での読解性を改善
- Artifact Adapter 分岐（PAPER/PR/DOC/SHEET）を Orchestrator に統合
- Agent orchestration trace（Planner〜Synthesizer）を段階保存する処理を追加
- Claim Miner に Critic -> Refiner 反復ループを追加し、弱い/重複主張を置換
- `summary.agents` でリアルタイム表示しやすいよう、agent traceの保存形式を統一
